### webkit的网页渲染过程
此内容是自我关于webkit技术内幕的学习内容。

首先，我们需要清楚网页的渲染过程指的是浏览器从用户输入的url转变成可视化的图像的过程。
这里我们大致把网页的渲染过程分为3个阶段:

1. 从网页的URL到构建完DOM树；
    这一阶段包括，
    1）利用网路模块，调用各种资源加载器加载各种资源。包括html资源，css资源和js资源等。
    2）利用html解析器，解析html资源形成DOM树。∂
    
    在解析html的过程中，遇到节点需要依赖其他资源，例如css，图片，异步js等，调用资源加载器来异步加载，这个过程不会阻碍当前DOM树的创建。
    但如果是需要加载同步的js资源的化，则需要停止当前的DOM树创建，加载js资源，然后调用js引擎（V8）来执行（解析和解释）加载的js脚本，执行完毕后，再继续DOM的创建。
    >这里还需要注意，在DOM创建的过程中，如果执行的js脚本资源要操作DOM的化，此时可能DOM树并没有创建完成，js不能访问DOM树。所以我们在编写时要注意，不要在DOM构建的过程中去访问DOM。所以对于js资源，首页不需要执行的，最好异步。需要执行的可以设置delay属性，或者后置。

    >这里还包括一个知识点：
    DOMContentLoaded:此事件在DOM树构建完成触发；
    onLoad:此事件在DOM树构建完，并且网页所依赖的资源加载完毕后触发。
    因为异步资源的存在，onLoad通常是晚于DOMContentLoaded发生。

2. 从DOM树构建完webkit的绘图上下文。
    这一过程大体包括：
    1）利用css解释器解释css文件，形成cssOM树，再匹配规则在DOM树上附加上样式信息，形成RenderObject树。
    2）一边在构建RenderObject树的同时，一边根据RenderObject树通过 布局计算（计算节点的层次,位置等）形成RenderLayer树。（也就是RenderObject树包括了节点的层次信息，复合样式信息，位置信息等）。
    3）通过RenderLayer树构建虚拟的绘图上下文。这一过程也是在构建RenderLayer树的同时进行的。

3. 从绘图上下文到最终在页面上看到的图像。
    这一过程大致包括：
    1）基于RenderLayer树信息，对某些RenderLayer对象对应构建新层，形成合成层(该RenderLayer对象被称为合成层)，在内存（如果开启了硬件加速，应该在GPU内存）中创建存储形成数据对象。
    2）将合成层包含的内容，在后端内存（如果开启了硬件加速，应该在GPU内存）中绘制。
    3）由合成器进程将多个合成层合成起来，形成网页最终可视化结果，实际上是一张图片。